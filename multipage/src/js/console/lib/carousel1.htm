<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    </meta>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title></title>
    <!-- Set the base URL for all relative URLs within the document -->
    <!-- <base href="https://example.com/page.html"> -->
    <!-- Link to an external CSS file -->
    <!-- <link rel="stylesheet" href="styles.css"> -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <!-- ================ firebase ============== -->
    <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
    <script src="https://www.gstatic.com/firebasejs/7.14.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.5/firebase-auth.js"></script>

    <style type="text/css">
        html {
            height: 100%;
            background-color: black;
        }

        body {
            height: 100%;
            background-color: black;
            color: white;
        }

        .wrapper {
            /* width:793px; */
            width: 50%;
            height: 50%;
            min-width: 400px;
            min-height: 50px;
        }

        /* @media screen and (min-width:100px) */
    </style>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css">

    <!-- <noscript>
        No JS alternative
    </noscript> -->

</head>

<body>
    <div class="container">
        <div id="myCarousel" class="carousel slide" data-ride="carousel" data-interval="false">
            <!-- Wrapper for slides -->
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <!-- ========================== card1 ==================================== -->
                    <div class="card" id="card1">
                        <article class="card-body">
                            <!-- <label class="text-primary">Singup<a><i class="far fa-arrow-alt-circle-right"></i></a></label> -->
                            <!-- <ul class="nav nav-tabs nav-justified" id="myTab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab"
                                        aria-controls="home" aria-selected="true">Login</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab"
                                        aria-controls="profile" aria-selected="false">Signup</a>
                                </li>
                            </ul> -->
                            <!-- <a href="" class="float-right btn btn-outline-primary">Sign up</a> -->
                            <div class="row">
                                <h1 class="col-7 card-title mb-4 mt-1 text-primary ">Login</h1>
                                <h6 class="col-5 card-title mb-4 mt-1 text-primary text-right" data-target="#myCarousel"
                                    data-slide-to="1">Register<i class="far fa-arrow-alt-circle-right"></i></h6>
                            </div>


                            <p>
                                <a href="" class="btn btn-block btn-outline-danger"> <i class="fab fa-google"></i>  
                                    Login
                                    via Google</a>
                                <a href="" class="btn btn-block btn-outline-primary"> <i class="fab fa-facebook-f"></i>
                                     
                                    Login via facebook</a>
                            </p>
                            <hr>
                            <form>
                                <div class="form-group">
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"> <i class="fa fa-user"></i> </span>
                                        </div>
                                        <input name="" class="form-control" placeholder="Login via email" type="email">
                                    </div> <!-- input-group.// -->
                                </div> <!-- form-group// -->
                                <div class="form-group">
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"> <i class="fa fa-lock"></i> </span>
                                        </div>
                                        <input class="form-control" placeholder="********" type="password">
                                    </div> <!-- input-group.// -->
                                </div> <!-- form-group// -->
                                <div class="row">
                                    <div class="col">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="customCheck1">
                                            <label class="custom-control-label text-primary"
                                                for="customCheck1">記住我</label>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <a class="custom-control float-right" href="#">重寄密碼</a>
                                    </div>
                                </div>


                                <div class="form-group">
                                    <button type="submit" class="btn btn-primary btn-block "> Login </button>
                                </div> <!-- form-group// -->
                            </form>
                        </article>
                    </div> <!-- card.// -->

                </div>
                <!-- End Item -->
                <!-- ========================== card2 ==================================== -->
                <div class="carousel-item">
                    <div class="card" id="card2">
                        <article class="card-body">
                            <!-- <label class="text-primary">Singup<a><i class="far fa-arrow-alt-circle-right"></i></a></label> -->
                            <!-- <ul class="nav nav-tabs nav-justified" id="myTab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab"
                                        aria-controls="home" aria-selected="true">Login</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab"
                                        aria-controls="profile" aria-selected="false">Signup</a>
                                </li>
                            </ul> -->
                            <!-- <a href="" class="float-right btn btn-outline-primary">Sign up</a> -->
                            <div class="row">

                                <h6 class="col-4 card-title mb-4 mt-1 text-primary" data-target="#myCarousel"
                                    data-slide-to="0">
                                    <i class="far fa-arrow-alt-circle-left"></i>Log in</h6>
                                <h1 class="col-8 card-title mb-4 mt-1 text-primary text-right">Register</h1>
                            </div>


                            <p>
                                <a href="" id="aRegisterGoogle" class="btn btn-block btn-outline-danger"> <i
                                        class="fab fa-google"></i>  
                                    Register
                                    via Google</a>
                                <a href="" id="aRegisterFacebook" class="btn btn-block btn-outline-primary"> <i
                                        class="fab fa-facebook-f"></i>
                                     
                                    Register via facebook</a>
                            </p>
                            <hr>
                            <form>
                                <div class="form-group">
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"> <i class="fa fa-user"></i> </span>
                                        </div>
                                        <input name="" class="form-control" placeholder="Register via email"
                                            type="email">
                                    </div> <!-- input-group.// -->
                                </div> <!-- form-group// -->
                                <div class="form-group">
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text"> <i class="fa fa-lock"></i> </span>
                                        </div>
                                        <input class="form-control" placeholder="********" type="password">
                                    </div> <!-- input-group.// -->
                                </div> <!-- form-group// -->
                                <!-- <div class="row">
                                    <div class="col">
                                        <div class="custom-control custom-checkbox">
                                            <input type="checkbox" class="custom-control-input" id="customCheck1">
                                            <label class="custom-control-label text-primary" for="customCheck1">記住我</label>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <a class="custom-control float-right" href="#">忘記密碼?</a>
                                    </div>
                                </div> -->


                                <div class="form-group">
                                    <button type="submit" class="btn btn-primary btn-block"> Register </button>
                                </div> <!-- form-group// -->
                            </form>
                        </article>
                    </div> <!-- card.// -->

                </div>
                <!-- End Item -->
                <div class="carousel-item">
                    <img src="http://images.yuppcdn.net/bazaar/20161219120644711101/1482129404711.jpg">

                </div>
                <!-- End Item -->
                <div class="carousel-item">
                    <img src="http://images.yuppcdn.net/images/20161021150745619424/1477042665635.jpg">
                </div>
                <!-- End Item -->
            </div>
            <!-- End Carousel Inner -->

        </div>
        <!-- End Carousel -->
    </div>

    <!-- ======================== test buttons ================================ -->
    <div>
        <button id="btnAddDB">Add DB</button>
        <button id="btnGetUsers">Get Users</button>
        <button id="btnUpdateUser">Update Users</button>
        <button id="btnRemoveUsers">Remove Users</button>
        <br>
        <button id="btnSignUp">SignUp</button>
        <button id="btnSignUpGoogle">SignUp Google</button>
        <button id="btnSignUpFB">SignUp FB</button>
        <button id="facebookSingUpPopup" class="fb">使用facebook註冊(Popup)</button>
        <button id="facebookSingUpRedirect" class="fb">使用facebook註冊(Redirect)</button>
        <button id="btnSetCookie">Set Cookie</button>
        <button id="btnListCookie">List Cookie</button>
        <button id="btnCheckLogin">Check Login</button>
        <button id="btnSetAuthPersistence">Set Auth Persistence</button>
        <button id="btnLoginGoogle">Login Google</button>
        <button id="btnLoginFacebook">Login Facebook</button>
        <button id="btnLoginEmail">Login Email</button>
        <button id="btnLogOut">Logout</button>
        
    </div>


    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous">
    </script>

    <script id="script1">
        //const firebase = require("firebase");
        var firebaseConfig = {
            apiKey: "AIzaSyD4H_AArvgvLf7HEmFBdHS6iUQcG3CTUOM",
            authDomain: "ming1-d8ff5.firebaseapp.com",
            databaseURL: "https://ming1-d8ff5.firebaseio.com/",
            projectId: "ming1-d8ff5" //,
            // storageBucket: "<BUCKET>.appspot.com",
            // messagingSenderId: "<SENDER_ID>"
        };
        firebase.initializeApp(firebaseConfig);
        //=============== login 登入
        let btnLoginGoogle = document.querySelector('#btnLoginGoogle');
        let btnLoginFacebook = document.querySelector('#btnLoginFacebook');
        let btnLoginEmail = document.querySelector('#btnLoginEmail');
        var provider = new firebase.auth.GoogleAuthProvider()
        btnLoginGoogle.addEventListener('click', (e) => {
            firebase.auth().signInWithPopup(provider).then(function (result) {
                // This gives you a Facebook Access Token. You can use it to access the Facebook API.
                var token = result.credential.accessToken;
                // The signed-in user info.
                var user = result.user;
                // ...
            }).catch(function (error) {
                // Handle Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
                // The email of the user's account used.
                var email = error.email;
                // The firebase.auth.AuthCredential type that was used.
                var credential = error.credential;
                // ...
            });

        })
        btnLoginFacebook.addEventListener('click', (e) => {

        })
        btnLoginEmail.addEventListener('click', (e) => {

        })
        //=============== logout 登出
        var btnLogOut = document.getElementById('btnLogOut');
        btnLogOut.onclick = function () {
            firebase.auth().signOut().then(function () {
                console.log('logout success!!')
                var user = firebase.auth().currentUser;
                console.log(user)
            })
        }
        //=============== check login
        let btnCheckLogin = document.querySelector('#btnCheckLogin');
        btnCheckLogin.addEventListener('click', function () {
            //check 1
            if (firebase.auth().currentUser) {
                const currentUser = firebase.auth().currentUser;
                console.log("Signed in username" + currentUser.displayName);
                console.log(currentUser)
                //this.props.navigation.navigate('AppTab');
            } else {
                console.log("no user signed in");
                //this.props.navigation.navigate('AuthTab');
            }
            //check 2
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    console.log('user is logged');
                }
            })
        })
        //=============== set auth persistence
        let btnSetAuthPersistence = document.querySelector('#btnSetAuthPersistence');
        btnSetAuthPersistence.addEventListener('click', (e) => {
            //set auth persistence 1
            firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL)
                .then(function () {
                    console.log("successfully set the persistence");
                })
                .catch(function (error) {
                    console.log("failed to ser persistence:" + error.message)
                });
            // 2.
            firebase.auth().signInWithEmailAndPassword(email, password)
                .then((user) => {
                    this.checkAccountStatus(user.uid, user.email);
                })
                .catch(function (error) {
                    //Handle Errors here.
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    console.log(errorMessage)
                    //...
                });
        })
        //=============== set cookie
        let btnSetCookie = document.querySelector('#btnSetCookie');
        let btnListCookie = document.querySelector('#btnListCookie');
        btnSetCookie.addEventListener('click',
            function () {
                // document.cookie =
                //     "username=John Doe; expires=Thu, 18 Dec 2021 12:00:00 GMT; domain=.example.com; path=/";
                document.cookie =
                    "username=John Doe; expires=Thu, 18 Dec 2021 12:00:00 GMT; path=/";
            })

        function listCookies() {
            var theCookies = document.cookie.split(';');
            var aString = '';
            for (var i = 1; i <= theCookies.length; i++) {
                aString += i + ' ' + theCookies[i - 1] + "\n";
            }
            return aString;
        }
        btnListCookie.addEventListener('click', function () {
            let list = listCookies();
            console.log(list)
        })

        //console.log(firebase)
        // firebase.initializeApp({
        //     apiKey: "AIzaSyBMg1W6kptlh3IvK4iTCV533ifz5rGLSCo", //api key
        //     authDomain: "caketest-b20b2.firebaseapp.com", //專案 ID caketest-b20b2
        //     databaseURL: "https://caketest-b20b2.firebaseio.com/"
        // });
        //const database = firebase.database();

        //database.ref('/').set(''); //clear db
        // 綁定註冊按鈕的點擊事件
        // submit.addEventListener('click', () => {
        //     // 點擊註冊按鈕時，紀錄使用者輸入的帳號密碼
        // tboxEmail.value = 'tristan829@gmail.com';
        // tboxPassword.value = 'qwer1111';
        // let user = {
        //     email: tboxEmail.value,
        //     pwd: tboxPassword.value
        // };
        //message.innerHTML = JSON.stringify(user);
        //     // 透過 auth().createUserWithEmailAndPassword 建立使用者
        function GetNewUID() {
            let uid = 0;
            return function () {
                uid++;
                return `uid-${uid}`;
            }
        }
        let GenId = GetNewUID();

        let btnAddDB = document.querySelector('#btnAddDB');
        let btnAddUser = document.querySelector('#btnAddUser')
        //btnAddUser.innerHTML = 'GGGGG'


        const db = firebase.firestore();
        // aRegisterGoogle



        //--------------Google
        function RegisterGoogle() {
            var provider = new firebase.auth.GoogleAuthProvider();
            //provider.addScope('https://www.googleapis.com/auth/contacts.readonly');
            //firebase.auth().languageCode = 'pt';
            // To apply the default browser preference instead of explicitly setting it.
            // firebase.auth().useDeviceLanguage();
            // provider.setCustomParameters({
            //     'login_hint': 'user@example.com'
            //   });
            //-----------To sign in with a pop-up window, call signInWithPopup:
            firebase.auth().signInWithRedirect(provider).then(function (result) {
                // This gives you a Google Access Token. You can use it to access the Google API.
                var token = result.credential.accessToken;
                console.log("LOG:: RegisterGoogle -> token", token)
                // The signed-in user info.
                var user = result.user;
                console.log("LOG:: RegisterGoogle -> user", user)
                // ...
                console.log('sign in success.')
            }).catch(function (error) {
                // Handle Errors here.
                var errorCode = error.code;
                console.log("LOG:: RegisterGoogle -> errorCode", errorCode)
                var errorMessage = error.message;
                // The email of the user's account used.
                var email = error.email;
                // The firebase.auth.AuthCredential type that was used.
                var credential = error.credential;
                // ...
                //console.log('error->', errorMessage)
            });
            //---------------To sign in by redirecting to the sign-in page, call signInWithRedirect
            //firebase.auth().signInWithPopup(provider);
            //firebase.auth().signInWithRedirect(provider);
            //------------------retrieve the Google provider's OAuth token
        }
        let btnSignUpGoogle = document.querySelector('#btnSignUpGoogle');
        let aRegisterGoogle = document.querySelector('#aRegisterGoogle');
        btnSignUpGoogle.addEventListener(
            'click', RegisterGoogle);
        aRegisterGoogle.addEventListener('click', RegisterGoogle);

        //--------------Facebook
        var providerF = new firebase.auth.FacebookAuthProvider();

        function RegisterFacebook() {
            firebase.auth().signInWithPopup(providerF).then(function (result) {
                // firebase.auth().signInWithRedirect(providerF).then(function (result) {
                var token = result.credential.accessToken;
                var user = result.user;
                console.log(user)
            })
        }

        var btnFacebookPopup = document.getElementById('facebookSingUpPopup');
        var btnFacebookRedirect = document.getElementById('facebookSingUpRedirect');
        btnFacebookPopup.onclick = RegisterFacebook


        // btnFacebookRedirect.onclick = function () {
        //     firebase.auth().signInWithRedirect(providerF).then(function (result) {
        //         var token = result.credential.accessToken;
        //         var user = result.user;
        //         console.log(user)
        //     })
        // }

        //add user
        btnAddDB.addEventListener('click', () => {

            //.add({...})
            //.set({...})
            //let newId = GetNewUID();
            db.collection("movies").doc("新世紀福爾摩斯2").set({
                    name: "新世紀福爾摩斯2",
                    date: "2012",
                    desctiption: "本劇改編自阿瑟·柯南·道爾爵士家喻戶曉的推理小說，一位脾氣古怪的大偵探在現代倫敦的街頭悄悄巡行，四處搜尋線索。",
                    actors: ["班尼迪克·康柏拜區", "馬丁·費曼"]
                })
                .then(function () {
                    //console.log("Document written with ID: ", docRef.id);

                    //md(`set data successful`);
                    console.log(`set data successful`)
                })
                .catch(function (error) {
                    //console.error("Error adding document: ", error);
                    //md(`Error adding document: ${error}`);
                    console.log(`Error adding document: ${error}`)
                });
            // db.collection("users").add({
            //         first: "Ada",
            //         last: "Lovelace",
            //         born: 1815
            //     })
            //     .then(function (docRef) {
            //         //console.log("Document written with ID: ", docRef.id);

            //         md(`Document written with ID: ${docRef.id}`);
            //     })
            //     .catch(function (error) {
            //         //console.error("Error adding document: ", error);
            //         md(`Error adding document: ${error}`);
            //     });
        });
        //get user
        btnGetUsers.addEventListener('click', () => {
            let docRef = db.collection("movies").doc("新世紀福爾摩斯");
            docRef.get().then(function (doc) {
                    if (doc.exists) {
                        //console.log(doc.data());
                        md_code(JSON.stringify(doc.data(), null, 4));
                    } else {
                        //console.log("找不到文件");
                        md('找不到文件');
                    }
                })
                .catch(function (error) {
                    //console.log("提取文件時出錯:", error);
                    md("提取文件時出錯:" + error);
                });

        });
        //Update user
        btnUpdateUser.addEventListener('click', () => {
            let docRef = db.collection("movies").doc("新世紀福爾摩斯");
            docRef.update({
                    date: '2013'
                })
                .then(function () {
                    //console.log("Document written with ID: ", docRef.id);

                    md(`update data successful`);
                })
                .catch(function (error) {
                    //console.error("Error adding document: ", error);
                    md(`Error adding document: ${error}`);
                });
        });
        //remove user
        btnRemoveUsers.addEventListener('click', () => {
            let docRef = db.collection("movies").doc("新世紀福爾摩斯");
            docRef.delete()
                .then(function () {
                    //console.log("Document written with ID: ", docRef.id);

                    md(`delete data successful`);
                })
                .catch(function (error) {
                    //console.error("Error adding document: ", error);
                    md(`Error adding document: ${error}`);
                });
        });

        let user = {
            email: 'tristan829@gmail.com',
            pwd: 'qwer1111'
        }
        let btnSignUp = document.querySelector('#btnSignUp');
        let precode = document.querySelector('#precode');
        btnSignUp.addEventListener('click', fnSignUp1);
        //-------------email password
        function fnSignUp1() {
            firebase.auth().createUserWithEmailAndPassword(user.email, user.pwd)
                .then(u => {
                    // 取得註冊當下的時間
                    //message.innerHTML = 'ready.....';
                    showmsg('ready.....');
                    let date = new Date();
                    let now = date.getTime();
                    //message.innerHTML = JSON.stringify(u);
                    // 記錄相關資訊到 firebase realtime database
                    // database.ref(u.uid).set({
                    //     signup: now,
                    //     email: user.email
                    // }).then(() => {
                    //     // 儲存成功後顯示訊息
                    //     //message.innerHTML = 'User created successfully';
                    //     showmsg('User created successfully');
                    // });
                    precode.innerHTML = JSON.stringify(u, null, 4)
                    showmsg('User created successfully');


                }).catch(err => {
                    // 註冊失敗時顯示錯誤訊息
                    //message.innerHTML = err.message;
                    showmsg(err.message);
                });
        }




        // function DelUser() {
        //     var user = firebase.auth().currentUser;
        //     message.innerHTML = JSON.stringify(user);
        //     // user.delete().then(function () {
        //     //     alert('你幫娘娘梳頭時不小心弄痛娘娘，被娘娘的掌事太監丟到井裡淹死了')
        //     // })
        // }
    </script>
</body>

</html>